extends layout

block content
	#content-card
		p.heading #{title}
		h3.error #{error}
		h3.error#error
		form#formAddPost(name="addpost",method="post",action="/addpost")
			input(type="hidden", name="userID", value="#{user._id}")
			input(type="hidden", name="tripDistance", value="")
			table#addPostForm
				tr
					td(style="border:0px;") Start:
					td(style="border:0px;")
						select#postSchool(name="start", style="width:100%", data-validation="required",data-validation-error-msg="Please select a school")
							option(value="") 
							each school, i in schools
								option(value="#{school._id}") #{school.School}
				tr
					td(style="border:0px;") End:
					td(style="border:0px;")
						input#postEndLocation(type="text", placeholder="", name="end", style="width:100%", data-validation="required",data-validation-error-msg="Please select an end location")
				tr
					td(style="border:0px;") Date:
					td(style="border:0px;")
						input#datePicker(type="text", placeholder="", name="date", style="width:100%",data-validation="date futuredate required",data-validation-format="mm/dd/yyyy")
				tr
					td(style="border:0px;") Time:
					td(style="border:0px;")
						input#timePicker(type="text", placeholder="", name="time", style="width:100%",data-validation="required")
				tr
					td(style="border:0px;") Cost ($):
					td(style="border:0px;")
						input#postCost(type="number", step="0.01", min="10", max="50", placeholder="", name="cost", style="width:100%",data-validation="required number", data-validation-allowing="range[10;50],float",data-validation-error-msg="please enter a number between $10 and $50")
				tr
					td(style="border:0px;") Available Seats:
					td(style="border:0px;")
						input#postAvailableSeats(type="number", step="1", min="1", max="10", placeholder="", name="available", style="width:100%",data-validation="required number", data-validation-allowing="range[1;10]",data-validation-error-msg="please enter a number between 1 and 10")
				tr
					td(style="border:0px;") Description:
					td(style="border:0px;")
						span#max-length-element 250
						|&nbsp;chars left
						textarea#postDescription(placeholder="", rows="3", name="description", style="width:100%",data-validation=" ")
				tr
					td(colspan="2",style="border:0px;")
						input#usertos(type="checkbox", data-validation="required",data-validation-error-msg="  *  You have to agree to our terms of service") 
						span(style="width:100%;") &nbsp;&nbsp; I agree to the #[a(href="/terms") Terms of service]
				tr
					td(colspan="2",style="border:0px;")
						input#btnSubmit(type="submit", value="Submit")
	script.
		var schoolData = !{JSON.stringify(schools)};
		$(document).ready(function(){
			$("#postEndLocation").focusout(function(){
				getDistanceData();
			});
			$("#postSchool").focusout(function(){
				getDistanceData();
			});
		});
		
		function getDistanceData()
		{
			if ($("#postSchool").val() != "" && $("#postEndLocation").val() != "")
			{
				var startSchool = findSchoolByID(schoolData, $("#postSchool").val());
				var Torigin = startSchool.campus["0"].location.Address + "," + startSchool.campus["0"].location.City + "," + startSchool.campus["0"].location.Province + "," + startSchool.campus["0"].location.Country + "," + startSchool.campus["0"].location.Postal;
				var Tdestination = $("#postEndLocation").val();
				var directionsService = new google.maps.DirectionsService;
				var directionsDisplay = new google.maps.DirectionsRenderer;
				directionsService.route({
					origin: Torigin,
					destination: Tdestination,
					travelMode: 'DRIVING',
					unitSystem: google.maps.UnitSystem.METRIC
				}, function(response, status) 
				{
					if (status === 'OK') 
					{
						var dM = response.routes["0"].legs["0"].distance.value;
						var dKM = Math.round(dM / 1000);
						var optimalPrice = (dKM * 0.1) + 10
						console.log(optimalPrice);
					}
				});
			}
		}
		
		function findSchoolByID(schoolJSON, schoolID)
		{
			for(i = 0; i < schoolJSON.length; i++)
			{
				if (schoolJSON[i]._id === schoolID)
				{
					return schoolJSON[i];
				}
			}
		}
	
